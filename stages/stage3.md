# Этап 3: Администрирование, оптимизация и мониторинг

## Задачи этапа

### 1. Настройка мониторинга
Необходимо установить и настроить систему мониторинга для базы данных.

**Требования:**
- Установить инструменты мониторинга на выбор
- Настроить экспорт полезных данных в Prometheus
- Установить Grafana
- Настроить экспорт метрик из Prometheus в Grafana
- Построить dashboard в Grafana с выбранными метриками
- Сохранить JSON dashboard из Grafana

**Архитектура:**
- Grafana и Prometheus должны быть подняты в отдельных контейнерах в docker-compose

### 2. Сервис имитации нагрузки
Необходимо написать сервис, имитирующий работу с базой данных.

**Требования к запросам:**
- Выбрать запросы, которые мог бы выполнять теоретический backend предметной области
- Запросы должны содержать большое количество JOIN-ов
- Запросы должны иметь разную селективность для наглядности оптимизации

### 3. Визуализация результатов
Необходимо сохранить и визуализировать результаты тестирования производительности.

**Требования:**
- Сохранить результаты тестирования
- Отрисовать диаграммы производительности в Grafana

### 4. Оптимизация производительности
Необходимо провести оптимизацию базы данных и измерить ее эффективность.

**Процесс оптимизации:**
- Добавить индексы к отношениям
- Запустить сервис тестирования снова
- Повторить процедуру несколько раз
- Добиться оптимальной производительности для каждого запроса

**Дополнительные методы оптимизации:**
- Партиционирование данных
- Материализованные представления
- Денормализация данных

### 5. Система резервного копирования
Необходимо реализовать автоматическое резервное копирование базы данных.

**Требования:**
- Создать cron задачу для создания бэкапов БД
- Бэкапы должны создаваться с заданным интервалом времени
- Должны храниться последние m бэкапов
- Более старые бэкапы должны автоматически удаляться

**Параметры конфигурации:**
- `BACKUP_RETENTION_COUNT` - количество хранимых бэкапов
- `BACKUP_INTERVAL_CRON` - интервал создания бэкапов в cron-формате

### 6. Обеспечение отказоустойчивости
Необходимо настроить репликацию для обеспечения отказоустойчивости кластера.

**Требования:**
- Развернуть 2 реплики PostgreSQL
- Использовать Patroni для управления репликацией
- Проверить автоматическое переключение при отказе мастера