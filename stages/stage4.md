# Этап 4: Тестирование миграций

## Задачи этапа

### Реализация механизма тестирования идемпотентности миграций

**Требования к миграциям:**
Каждая миграция должна иметь два скрипта:
- `up` — применяет изменения (создает таблицы, поля, индексы, наполняет справочники и т.д.)
- `down` — полностью отменяет все изменения этой миграции

### Процедура тестирования для каждой миграции

Для каждой миграции в отдельности необходимо выполнить следующие шаги:

1. Применить скрипт `up`
2. Сохранить текущее состояние базы (схему и, при необходимости, справочные данные)
3. Откатить изменения скриптом `down`
4. Снова применить скрипт `up`
5. Сохранить новое состояние базы
6. Сравнить первые и вторые снимки состояния базы

**Критерий успеха:** Снимки состояния базы должны совпадать - это является признаком идемпотентности миграции.

### Порядок выполнения

- Повторить процедуру для каждой миграции по порядку их нумерации
- Тестирование должно проводиться последовательно для всех миграций

### Дополнительное задание

Автоматизировать всю проверку (например, в CI/CD), чтобы при любых расхождениях выполнение тестов завершалось с ошибкой.